<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pkg2</title>
    <script src="./index.umd.js"></script>
    <style>
      html,
      body {
        padding: 0;
        margin: 0;
      }

      #popover {
        background-color: red;
      }
    </style>
  </head>

  <body>
    <video
      src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      controls
      id="video"
    ></video>
    <div id="progress"></div>
    <div id="volume" style="padding-top: 200px"></div>
    <div id="popover">popover</div>
    <script>
      (function () {
        const progress = new Pkg.Progress({
          duration: 500, //
          current: 0,
          getContainer: document.getElementById("progress"),
        });

        const volume = new Pkg.Volume({
          getContainer: document.getElementById("volume"),
        });

        /** @type {HTMLVideoElement} */
        const $video = document.getElementById("video");
        console.log($video);

        window.addEventListener("load", () => {
          $video.load();
        });

        $video.addEventListener("progress", () => {
          if ($video.buffered.length > 0) {
            console.log("video.buffered", $video.buffered);
            // 获取缓冲的最后一个区间的结束时间
            const bufferedEnd = $video.buffered.end($video.buffered.length - 1);
            const duration = $video.duration;
            console.log(`视频的总时长：${duration}秒`);
            console.log(`已加载的部分长度：${bufferedEnd}秒`);
            console.log(`加载的百分比：${(bufferedEnd / duration) * 100}%`);
            progress.disabled = !(duration > 0);
            progress.setDuration(duration);
            progress.setBuffered($video.buffered);
          }
        });

        // 监听视频播放时间的更新
        $video.addEventListener("timeupdate", function () {
          if ($video.buffered.length > 0) {
            console.log("video.buffered", $video.buffered);
            // 获取缓冲的最后一个区间的结束时间
            const bufferedEnd = $video.buffered.end($video.buffered.length - 1);
            const duration = $video.duration;
            console.log(`视频的总时长：${duration}秒`);
            console.log(`已加载的部分长度：${bufferedEnd}秒`);
            console.log(`加载的百分比：${(bufferedEnd / duration) * 100}%`);
            progress.disabled = !(duration > 0);
            progress.setDuration(duration);
            progress.setBuffered($video.buffered);

            // 获取视频的当前播放时间
            progress.current = $video.currentTime;
            console.log("timeupdate", progress.current);
          }
        });

        // Popover
        const popover = new Pkg.Popover({
          getPopupContainer: () => document.getElementById("popover"),
          title: "title",
          list: [
            { label: "item1", value: 1 },
            { label: "item2", value: 2 },
            { label: "item3", value: 3 },
            { label: "item4", value: 4 },
            { label: "item5", value: 5 },
            { label: "item6", value: 6 },
          ],
        });
      })();
    </script>
  </body>
</html>
